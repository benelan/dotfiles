# Read `man 5 sway` for a complete reference.
# vim:foldmethod=marker:filetype=swayconfig:

# stuff shared with i3 config
include ~/.config/i3/common

### Variables {{{1
#
# Mod1 is Alt, Mod4 is Super

# https://github.com/swaywm/swaylock
set $lock 'swaylock -Feflc 000000'

include /etc/sway/config-vars.d/*


### Inputs {{{1
#
# You can get the names of your inputs by running: swaymsg -t get_inputs
# Read `man 5 sway-input` for more information about this section.
#
# Configure scrolling and clicking with the touchpad
input "type:touchpad" {
    dwt enabled
    tap disabled
    natural_scroll enabled
    middle_emulation enabled
    click_method clickfinger
    scroll_method two_finger
    accel_profile adaptive
    pointer_accel 0.25
}

# For options, see: $ localectl list-x11-keymap-options
input "type:keyboard" {
    xkb_options caps:escape
    # xkb_options shift:both_capslock
    # xkb_options shift:breaks_caps
}

### Outputs {{{1
#
# Wallpaper
output * bg "$(xdg-user-dir PICTURES)/Wallpapers/current" fill

# Monitor resolution and positioning (aligns at bottom instead of top)
# output eDP-1 resolution 1920x1080 position 0,0
# output DP-1 resolution 2560x1440 position 1920,360


### Keybindings {{{1
#
# clipboard history manager
bindsym $mod+Shift+y exec cliphist list | rofi -dmenu -p 'cliphist' | cliphist decode | wl-copy

# https://github.com/swaywm/sway/wiki/Useful-add-ons-for-sway#screenshot
bindsym Print exec grimshot copy area
bindsym $mod+Shift+Print exec grimshot save area
bindsym $mod+Print exec wl-copy < "$(grimshot save active)"
bindsym $mod+Mod1+Print exec wl-copy < "$(grimshot save output)"

# select an area of the screen and copy the text within to the clipboard
# https://github.com/tesseract-ocr/tesseract
bindsym $mod+y exec grim -s 3 -g "$(slurp)" -l 0 - | \
    convert - -bordercolor White -border 10x10 -contrast-stretch 0 \
        -opaque none +matte -sharpen 0x1 - | \
    tesseract - - --psm 6 \
        -c "load_system_dawg=0" \
        -c "load_freq_dawg=0" \
        -c "preserve_interword_spaces=1" \
        -c "segment_nonalphabetic_script=1" | \
    wl-copy

# colorpicker
bindsym $mod+c exec grim -g "$(slurp -p)" -t ppm - | \
convert - -format "%[pixel:p{0,0}]" txt:- | \
    tail -n 1 | cut -d " " -f 4 | wl-copy

# Exit sway (logs you out of your Wayland session)
bindsym $mod+Shift+e exec swaynag -t warning -m "Exiting sway will end the Wayland session, are you sure?" -B "Yes, exit sway" 'swaymsg exit'

# Move cursor using keys
mode "mouse" {
    bindsym Shift+h seat - cursor move -10   0
    bindsym Shift+j seat - cursor move   0  10
    bindsym Shift+k seat - cursor move   0 -10
    bindsym Shift+l seat - cursor move  10   0

    bindsym $mod+h seat - cursor move -50   0
    bindsym $mod+j seat - cursor move   0  50
    bindsym $mod+k seat - cursor move   0 -50
    bindsym $mod+l seat - cursor move  50   0

    bindsym h seat - cursor move -100   0
    bindsym j seat - cursor move   0  100
    bindsym k seat - cursor move   0 -100
    bindsym l seat - cursor move  100   0

    bindsym Control+h seat - cursor move -400   0
    bindsym Control+j seat - cursor move   0  400
    bindsym Control+k seat - cursor move   0 -400
    bindsym Control+l seat - cursor move  400   0

    bindsym Space seat - cursor press button1
    bindsym $mod+Space seat - cursor press button2
    bindsym Return seat - cursor press button1, mode "default"
    bindsym Escape mode "default"
    bindsym q mode "default"
}

bindsym $mod+Control+Space mode "mouse"


### Window assignments {{{1
#
# Automatically open apps in specific workspaces
# Find the class/app_id/etc of open windows with: $ swaymsg -t get_tree

assign [app_id="^firefox$"] $ws1
# assign [app_id="^gnome-terminal-server$"] $ws2
assign [app_id="^(file-roller|gedit|gnome-calculator|gnome-calendar|org\.gnome\.Nautilus)$"] $ws5
assign [app_id="^(mpv|vlc|shotwell|lollypop|ghb|org\.inkscape\.Inkscape)$"] $ws6
assign [app_id="^thunderbird(-esr)?$"] $ws8

for_window [app_id="^mpv$" title=".*\.jpg - mpv$"] floating enable, resize set width 39 ppt height 40 ppt, move position 61 ppt 60 ppt, move scratchpad, scratchpad show
for_window [app_id="^(vlc|mpv|firefox)$"] focus, inhibit_idle focus

### UI {{{1
#
bar {
    # status_command i3status
    swaybar_command waybar

    position top
    tray_output primary
    font pango:Iosevka Nerd Font 12

    colors {
        # Bar background color
        background $bg0_s
        # Text color used for blocks that do not have a color specified
        statusline $fg1
        # Workspaces section
        #                   border     background    text
        focused_workspace   $blue      $blue         $black
        inactive_workspace  $bg0_h     $bg0_h        $fg1
        active_workspace    $bg0_h     $bg0_h        $fg1
        urgent_workspace    $red       $red          $black
    }
}

include /etc/sway/config.d/*


### Idle/lock/suspend {{{1
#
# https://github.com/swaywm/swayidle
#
# Dim the screen after 5 min, undim if user becomes active.
# Turn off the display 1 min after it dimmed, as a last chance to resume w/o password
# Lock the screen 1 min after the display turned off.
# Suspend the system after 22 min (total) of idle time.
# Update the status bar's weather info after unlocking or resuming from sleep
exec --no-startup-id swayidle -w \
    timeout 300 'brightnessctl --class=backlight get >/tmp/idle_brightness; \
                 brightnessctl --class=backlight set 33%-' \
         resume 'brightnessctl --class=backlight set $(cat /tmp/idle_brightness)' \
    timeout 360 'swaymsg "output * dpms off"' \
         resume 'swaymsg "output * dpms on"' \
    timeout 420 $lock \
    timeout 1337 'systemctl suspend' \
    lock $lock \
    before-sleep $lock \
    unlock 'sleep 30 && weather info >/tmp/weather' \
    after-resume 'sleep 30 && weather info >/tmp/weather'

# Turn off the display and lock the session when the laptop lid is closed
bindswitch lid:off exec swaymsg "output * dpms off"; exec $lock

# Turn on the display when the laptop lid is opened
bindswitch lid:on exec swaymsg "output * dpms on"

# Don't go idle and lock if the current window is fullscreen
for_window [title=".*"] inhibit_idle fullscreen


### Startup processes {{{1
#
# Clipboard history manager
# https://github.com/sentriz/cliphist
exec exec wl-paste --watch cliphist store
