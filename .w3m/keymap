# Sources {{{1
# https://github.com/gotbletu/dotfiles_v2/blob/master/normal_user/w3m/.w3m/keymap
# https://github.com/felipesaa/A-vim-like-firefox-like-configuration-for-w3m
# https://github.com/tats/w3m/blob/master/doc/README.func
# https://vitalyparnas.com/guides/w3m/

# Disable some defaults {{{1
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# keymap	C-@    NULL  # MARK
# keymap	C-_    NULL  # GOTO_HOME
# keymap	C-a    NULL  # LINE_BEGIN
keymap	C-b    NULL  # MOVE_LEFT
keymap	C-e    NULL  # LINE_END
keymap	C-f    NULL  # MOVE_RIGHT
# keymap	C-g    NULL  # LINE_INFO
# keymap	C-h    NULL  # HISTORY
# keymap	TAB    NULL  # NEXT_LINK
# keymap	C-j    NULL  # GOTO_LINK
# keymap	C-k    NULL  # COOKIE
# keymap	C-l    NULL  # REDRAW
# keymap	C-m    NULL  # GOTO_LINK
keymap	C-n    NULL  # MOVE_DOWN
keymap	C-p    NULL  # MOVE_UP
# keymap	C-q    NULL  # CLOSE_TAB
# keymap	C-r    NULL  # ISEARCH_BACK
# keymap	C-s    NULL  # ISEARCH
# keymap	C-t    NULL  # TAB_LINK
keymap	C-u    NULL  # PREV_LINK
keymap	C-v    NULL  # NEXT_PAGE
# keymap	C-w    NULL  # WRAP_TOGGLE
# keymap	C-z    NULL  # SUSPEND

# keymap	SPC    NULL  # NEXT_PAGE
# keymap	!      NULL  # SHELL
# keymap	\"     NULL  # REG_MARK
# keymap	#      NULL  # PIPE_SHELL
# keymap	$      NULL  # LINE_END
# keymap	(      NULL  # UNDO
# keymap	)      NULL  # REDO
# keymap	+      NULL  # NEXT_PAGE
# keymap	,      NULL  # LEFT
# keymap	-      NULL  # PREV_PAGE
# keymap	.      NULL  # RIGHT
# keymap	/      NULL  # SEARCH
keymap	:      NULL  # MARK_URL
keymap	";"    NULL  # MARK_WORD
# keymap	<      NULL  # SHIFT_LEFT
# keymap	=      NULL  # INFO
# keymap	>      NULL  # SHIFT_RIGHT
# keymap	?      NULL  # SEARCH_BACK
# keymap	@      NULL  # READ_SHELL
# keymap	B      NULL  # BACK
# keymap	D      NULL  # DOWNLOAD_LIST
# keymap	E      NULL  # EDIT
# keymap	F      NULL  # FRAME
# keymap	G      NULL  # END
keymap	H      NULL  # HELP
# keymap	I      NULL  # VIEW_IMAGE
keymap	J      NULL  # UP
keymap	K      NULL  # DOWN
keymap	L      NULL  # LIST
# keymap	M      NULL  # EXTERN
# keymap	N      NULL  # SEARCH_PREV
# keymap	Q      NULL  # EXIT
# keymap	R      NULL  # RELOAD
# keymap	S      NULL  # SAVE_SCREEN
# keymap	T      NULL  # NEW_TAB
keymap	U      NULL  # GOTO
# keymap	V      NULL  # LOAD
# keymap	W      NULL  # PREV_WORD
# keymap	Z      NULL  # CENTER_H
# keymap	[      NULL  # LINK_BEGIN
# keymap	]      NULL  # LINK_END
# keymap	\^     NULL  # LINE_BEGIN
keymap	a      NULL  # SAVE_LINK
keymap	b      NULL  # PREV_PAGE
# keymap	c      NULL  # PEEK
# keymap	g      NULL  # BEGIN
# keymap	h      NULL  # MOVE_LEFT
# keymap	i      NULL  # PEEK_IMG
# keymap	j      NULL  # MOVE_DOWN
# keymap	k      NULL  # MOVE_UP
# keymap	l      NULL  # MOVE_RIGHT
# keymap	m      NULL  # MOUSE_TOGGLE
# keymap	n      NULL  # SEARCH_NEXT
keymap	o      NULL  # OPTIONS
keymap	q      NULL  # QUIT
keymap	r      NULL  # VERSION
keymap	s      NULL  # SELECT_MENU
keymap	u      NULL  # PEEK_LINK
# keymap	v      NULL  # VIEW
# keymap	w      NULL  # NEXT_WORD
# keymap	z      NULL  # CENTER_V
# keymap	{      NULL  # PREV_TAB
# keymap	|      NULL  # PIPE_BUF
# keymap	}      NULL  # NEXT_TAB

# keymap	M-TAB  NULL # PREV_LINK
keymap	M-C-j  NULL # SAVE_LINK
keymap	M-C-m  NULL # SAVE_LINK
               
# keymap	M-:    NULL # MARK_MID
# keymap	M-<    NULL # BEGIN
# keymap	M->    NULL # END
# keymap	M-I    NULL # SAVE_IMAGE
# keymap	M-M    NULL # EXTERN_LINK
# keymap	M-W    NULL # DICT_WORD_AT
# keymap	M-a    NULL # ADD_BOOKMARK
# keymap	M-b    NULL # BOOKMARK
# keymap	M-c    NULL # COMMAND
# keymap	M-e    NULL # EDIT_SCREEN
# keymap	M-g    NULL # GOTO_LINE
# keymap	M-k    NULL # DEFINE_KEY
# keymap	M-l    NULL # LIST_MENU
# keymap	M-m    NULL # MOVE_LIST_MENU
# keymap	M-n    NULL # NEXT_MARK
# keymap	M-o    NULL # SET_OPTION
# keymap	M-p    NULL # PREV_MARK
# keymap	M-s    NULL # SAVE
# keymap	M-t    NULL # TAB_MENU
keymap	M-u    NULL # GOTO_RELATIVE
keymap	M-v    NULL # PREV_PAGE
# keymap	M-w    NULL # DICT_WORD
               
# keymap	UP	   NULL # MOVE_UP
# keymap	DOWN   NULL # MOVE_DOWN
# keymap	RIGHT  NULL # MOVE_RIGHT
# keymap	LEFT   NULL # MOVE_LEFT

keymap	M-[E   NULL # MENU
keymap	M-[L   NULL # MENU
# keymap	M-[Z   NULL # PREV_LINK

keymap	M-[1~  NULL # BEGIN
keymap	M-[2~  NULL # MENU
keymap	M-[4~  NULL # END
keymap	M-[5~  NULL # PREV_PAGE
keymap	M-[6~  NULL # NEXT_PAGE
keymap	M-[28~ NULL # MENU

# Vim-style remaps {{{1
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## Navigation {{{2
keymap  C-d     NEXT_HALF_PAGE
keymap  C-u     PREV_HALF_PAGE

keymap  C-f     NEXT_PAGE
keymap  C-b     PREV_PAGE

keymap  l       MOVE_RIGHT
keymap  h       MOVE_LEFT
keymap  j       MOVE_DOWN1
keymap  k       MOVE_UP1

keymap  C-e     DOWN
keymap  C-y     UP

keymap  0       LINE_BEGIN
keymap  ^       LINE_BEGIN
keymap  $       LINE_END

keymap  gg      BEGIN
keymap  G       END
keymap  G       GOTO_LINE

keymap  w       NEXT_WORD
keymap  b       PREV_WORD

keymap  C-n     NEXT_LINK
keymap  C-p     PREV_LINK

## Hyperlinks {{{2
# Follow current hyperlink in a new buffer (GOTO_LINK)
# NOTE: Ctrl-Shift-J doesn't work as a different hotkey
# Follow current hyperlink in a new tab (TAB_LINK)
# keymap  t       TAB_LINK
# Show current address (PEEK)
keymap  pk      PEEK
# Show target address (PEEK_LINK)
keymap  pl      PEEK_LINK
# Show image address (PEEK_IMG)
keymap  pi      PEEK_IMG
# Show all URLs referenced (LIST)
keymap  gl      LIST
# Pop up menu for hyperlinks to browse to (LIST_MENU)
keymap  gs      LIST_MENU
# Pop up link element menu (LINK_MENU)
keymap  ge      LINK_MENU
# Pop up accesskey menu (ACCESSKEY)
keymap  ga      ACCESSKEY

#### toggle hinting mode (vimium similar)
keymap  s-SPC   COMMAND "SET_OPTION display_link_number=toggle ; RESHAPE"
#### jump to link number (e.g press 3ss) and hide hinting mode
keymap  ss      COMMAND "SET_OPTION display_link_number=0 ; RESHAPE ; LINK_BEGIN"
#### copy link to clipboard (e.g press s-SPC then 4sy to yank url)
keymap  sy      COMMAND "SET_OPTION display_link_number=0 ; RESHAPE ; LINK_BEGIN ; EXTERN_LINK 'url=%s ; printf "%b" "$url" | cb 2>/dev/null ;"
#### jump to link number and open it
keymap  so      COMMAND "SET_OPTION display_link_number=0 ; RESHAPE ; LINK_BEGIN ; GOTO_LINK"
#### jump to link number and open it in new tab
keymap  st      COMMAND "SET_OPTION display_link_number=0 ; RESHAPE ; LINK_BEGIN ; TAB_LINK"

## Files/Buffers/Tabs {{{2
keymap  o       GOTO
keymap  O       GOTO_RELATIVE

keymap  J       NEXT
keymap  K       PREV
keymap  L       NEXT_TAB
keymap  H       PREV_TAB

keymap  gt      NEXT_TAB
keymap  gT      PREV_TAB

keymap  C-wL    TAB_RIGHT
keymap  C-wH    TAB_LEFT

keymap  gS      SELECT_MENU

## Miscellaneous {{{2
keymap  ESC-C-j SUBMIT

keymap  gh      HISTORY
keymap  gd      DOWNLOAD_LIST
keymap  gm      MAIN_MENU

keymap  ZZ      QUIT
keymap  ZQ      EXIT

keymap  ::      COMMAND
keymap  :q      QUIT
keymap  :h      HELP
keymap	:o      OPTIONS
keymap	:v      VERSION
keymap  :e      LOAD
keymap  :w      SAVE

# Shell commands {{{1
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

keymap  :b      SHELL         "$EDITOR ~/.config/surfraw/bookmarks"
keymap  :c      SHELL         "$EDITOR ~/.w3m/config"
keymap  :k      SHELL         "$EDITOR ~/.w3m/keymap"
keymap  :t      SHELL         "$EDITOR ~/.w3m/RestoreTab.txt"

# External commands {{{1
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# EXTERN_LINK = under cursor
# EXTERN      = current page

# yank url to clipboard
keymap  yy      EXTERN_LINK   "(printf %s | cb)"
keymap  yY      EXTERN        "(printf %s | cb)"
# yank url to tmux clipboard
keymap  yt      EXTERN_LINK   "tmux set-buffer"
keymap  yT      EXTERN        "tmux set-buffer"

# open gui browser
keymap  gx      EXTERN_LINK   "firefox"
keymap  gX      EXTERN        "firefox"

keymap  xv      SHELL         "vim $W3M_CURRENT_FORM"

keymap  xr      COMMAND       "READ_SHELL 'readable $W3M_URL -p html-title,html-content > /tmp/readable.html' ; LOAD /tmp/readable.html; DELETE_PREVBUF"
keymap  xt      COMMAND       "TAB_GOTO https://duckduckgo.com/lite/; NEXT_LINK; GOTO_LINK"
# keymap  xg      COMMAND       "TAB_GOTO https://google.com; GOTO_LINE 6; NEXT_LINK; GOTO_LINK"
# keymap  xx      COMMAND       "TAB_GOTO https://stackexchange.com; GOTO_LINE 7; NEXT_LINK; GOTO_LINK"

# Other commands {{{1
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# leader key = \
keymap  \\\c    COMMAND       "SET_OPTION color=toggle ; RESHAPE"
keymap  \\\l    COMMAND       "SET_OPTION display_link_number=toggle ; SET_OPTION show_lnum=toggle ; RESHAPE"
keymap  \\\b    COMMAND       "SET_OPTION display_borders=toggle ; RESHAPE"
keymap  \\\i    COMMAND       "SET_OPTION display_image=toggle ; RELOAD"
keymap  \\\e    COMMAND       "SET_OPTION user_agent='' ; RELOAD"
keymap  \\\a    COMMAND       "SET_OPTION user_agent Mozilla/5.0 (Windows NO 10.0; rev:91.0) Gecko/20100101 Firefox91.0 ; RELOAD"
keymap  \\\?    COMMAND       "HELP; SEARCH User-Defined; CENTER_V"
# keymap  \\\m    COMMAND       "SHELL 'man w3m'"

# CGI-BIN {{{1
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# paste and go
keymap  pp      GOTO          file:/cgi-bin/goto_clipboard.cgi
keymap  pP      TAB_GOTO      file:/cgi-bin/goto_clipboard.cgi
keymap  pt      GOTO          file:/cgi-bin/goto_clipboard_tmux.cgi
keymap  pT      TAB_GOTO      file:/cgi-bin/goto_clipboard_tmux.cgi

# restore closed tabs
keymap  u       TAB_GOTO      file:/cgi-bin/restore_tab.cgi

# close tabs and save url link to file
keymap  qq      COMMAND       "EXTERN 'echo %s >> ~/.w3m/RestoreTab.txt' ; CLOSE_TAB"

# open bookmarks (surfraw) using fzf
keymap  xo      COMMAND       "SHELL ~/.w3m/cgi-bin/fzf_bookmarks.cgi ; GOTO file:/cgi-bin/goto_clipboard_tmux.cgi"
keymap  xO      COMMAND       "SHELL ~/.w3m/cgi-bin/fzf_bookmarks.cgi ; TAB_GOTO file:/cgi-bin/goto_clipboard_tmux.cgi"

# save bookmarks (surfraw)
keymap  xb      COMMAND       "EXTERN_LINK '(echo -n %s | xclip -selection clipboard)' ; SHELL ~/.w3m/cgi-bin/save_bookmark_surfraw.cgi"
keymap  xB      COMMAND       "EXTERN '(echo -n %s | xclip -selection clipboard)' ; SHELL ~/.w3m/cgi-bin/save_bookmark_surfraw.cgi"

# go to clipboard hyperlink
keymap  xs      COMMAND       "READ_SHELL ~/.w3m/cgi-bin/fzf_surfraw.cgi ; BACK ; GOTO file:/cgi-bin/goto_clipboard_tmux.cgi"
keymap  xS      COMMAND       "READ_SHELL ~/.w3m/cgi-bin/fzf_surfraw.cgi ; BACK ; TAB_GOTO file:/cgi-bin/goto_clipboard_tmux.cgi"
